import org.apache.spark.sql.SparkSession;
import org.apache.spark.util.MutableURLClassLoader;

import java.net.URLClassLoader;

public class Test1 {
    public static void main(String[] args) {
        // Assurer un vrai parent URLClassLoader
        ClassLoader sysCl = ClassLoader.getSystemClassLoader();
        URLClassLoader parent;
        if (sysCl instanceof URLClassLoader) {
            parent = (URLClassLoader) sysCl;
        } else {
            parent = new URLClassLoader(new java.net.URL[] {}, null);
        }

        // Forcer Hive Ã  avoir un classloader compatible
        Thread.currentThread().setContextClassLoader(
            new MutableURLClassLoader(new java.net.URL[]{}, parent)
        );

        SparkSession spark = SparkSession.builder()
                .appName("TestApp")
                .master("local[*]")
                .enableHiveSupport()
                .getOrCreate();

        spark.sql("show databases").show();
    }
}
